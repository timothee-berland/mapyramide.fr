<?php

App::uses('AppController', 'Controller');

class EncyclopedieController extends AppController {
/**
	 * Controller name
	 *
	 * @var string
	 */
		public $name = 'Encyclopedie';

	/**
	 * This controller does not use a model
	 *
	 * @var array
	 */
		public $uses = array();

	/**
	 * Displays a view
	 *
	 * @param mixed What page to display
	 * @return void
	 */
	public function beforeFilter() {
			parent::beforeFilter();
			$this->Auth->allow('display'); // Letting non-users see public pages
		}

	public function encyclopedie() {
		
		}
		
	// Résultats de la recherche du 1er aliment
	function resultatsRecherche1() {
		if (!empty ($_POST['zone-aliment'])) {
			$aRechercher = $_POST['zone-aliment'];
			$resultats = getAliments($aRechercher); 
			if (sizeof($resultats) >= 1) {
				$i = 0;
				echo "<ul>";
				foreach ($resultats as $resultat) {
					$url = "?page=encyclo-aliment1&valeur1=".$resultats[$i]['numAliment'];
					echo "<li><a href=\"".$url."\">".$resultats[$i]['nomFR']."</a></li>";
					$i++;
				}
				echo "</ul>";
			} else {
				echo "Aucun résultat ne correspond à votre recherche";
			}
		} else {
			echo "Veuillez saisir le nom de l'aliment à rechercher";
		}
	}

	
    // Résultats de la recherche du 2nd aliment
	function resultatsRecherche2() {
	    	if (!empty ($_POST['zone-aliment'])) {
				$aRechercher = $_POST['zone-aliment'];
				$resultats = getAliments($aRechercher); 
				if (sizeof($resultats) >= 1) {
					$i = 0;
					echo "<ul>";
					foreach ($resultats as $resultat) {
						$url = "?page=encyclo-aliment2&valeur1=".$_GET['valeur1']."&valeur2=".$resultats[$i]['numAliment'];
						echo "<li><a href=\"".$url."\">".$resultats[$i]['nomFR']."</a></li>";
						$i++;
					}
					echo "</ul>";
				} else {
					echo "Aucun résultat ne correspond à votre recherche";
				}
			} else {
					echo "Veuillez saisir le nom de l'aliment à rechercher";
			}
	    }
		
	// Composants qui constituent un aliment
	function compoAliment($aliment) {
		$composition = getCompoAliment($aliment);
		$i = 0;
		echo "<ul>";
		foreach ($composition as $composant) {
		    echo "<li>".$composition[$i]['specFR']."</li>";
			echo "</ul>";
			$i++;
		}
	}
	
	// Principaux composants d'un aliment
	function principauxConstituants ($aliment) {
		$energie 	= getEnergieAliment($aliment);
		$lipide 	= getLipidesAliment($aliment);
		$glucide 	=  getGlucidesAliment($aliment);
		$ag 		= getAGSAliment($aliment);
		$sodium		= getSodiumAliment($aliment);
		
		echo "<ul>";
		if ($energie != null){		
			echo "<li>Calories vides <p> ".$energie['valeurMoy']." </p></li>";
		} else {
				echo "<li>Calories vides <p> 0 </p></li>";
		}
		
		if ($lipide != null) {
			echo "<li>Matieres grasses  <p>".$lipide['valeurMoy']." cal </p></li>"; 
		} else {
			echo "<li>Matieres grasses  <p>0 cal </p> </li>"; 
		}
		
		if ($glucide != null) {
			echo "<li>Sucres ajoutés <p>".$glucide['valeurMoy']." cal </p> </li>";
		} else {
			echo "<li>Sucres ajoutés <p>0 cal </p></li>";
		}
		
		if ($ag != null) {
			echo "<li>Graisses saturées  <p> ".$ag['valeurMoy']." g </p></li>";
		} else {
			echo "<li>Graisses saturées <p>0 g </p></li>";
		}
		
		if ($sodium != null) {
			echo "<li>Sodium &nbsp <p>".$sodium['valeurMoy']." mg </p></li>";
		} else {
			echo "<li>Sodium &nbsp <p> 0 mg </p></li>";
		}
		
		echo "</ul>";
	}

	// Tous les composants d'un aliment
	function tousLesCompos($aliment) {
	    $compo = getCompoAliment($aliment);
		
		if ($compo != null) {
			echo "<table>";
			$i = 0;
			foreach ($compo as $composant) {
				echo "<tr><td>".$compo[$i]['specFR']."</td>";
				echo "<td><p>".$compo[$i]['valeurMoy']."</p></td></tr>";
				$i++;
			}
			echo "</table>";
		} else {
		    echo "Informations nutritionnelles non disponibles";
		}
	}
}